<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section2 UMAP and t-SNE | Advanced Dimension Reduction with UMAP and t-SNE and how to create Interactive Notebooks - AcqVA Aurora workshop</title>
  <meta name="description" content="Section2 UMAP and t-SNE | Advanced Dimension Reduction with UMAP and t-SNE and how to create Interactive Notebooks - AcqVA Aurora workshop" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Section2 UMAP and t-SNE | Advanced Dimension Reduction with UMAP and t-SNE and how to create Interactive Notebooks - AcqVA Aurora workshop" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section2 UMAP and t-SNE | Advanced Dimension Reduction with UMAP and t-SNE and how to create Interactive Notebooks - AcqVA Aurora workshop" />
  
  
  

<meta name="author" content="Martin Schweinberger" />


<meta name="date" content="2024-01-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="generating-interactive-notebooks.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Dimension Reduction and Interactive Notebooks</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-do-before-the-workshop"><i class="fa fa-check"></i>What to do before the workshop</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#timeline"><i class="fa fa-check"></i>Timeline</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#getting-started"><i class="fa fa-check"></i>Getting started</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html"><i class="fa fa-check"></i><b>2</b> UMAP and t-SNE</a>
<ul>
<li class="chapter" data-level="" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html#comparison-between-umap-and-pca"><i class="fa fa-check"></i>Comparison between UMAP and PCA</a></li>
<li class="chapter" data-level="" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html#key-aspects-of-umap"><i class="fa fa-check"></i>Key aspects of UMAP</a></li>
<li class="chapter" data-level="" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html#what-are-differences-between-umap-and-t-sne"><i class="fa fa-check"></i>What are differences between UMAP and t-SNE?</a></li>
<li class="chapter" data-level="" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html#additional-accessible-resources"><i class="fa fa-check"></i>Additional (accessible) resources</a></li>
<li class="chapter" data-level="" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html#how-does-umap-work"><i class="fa fa-check"></i>How does UMAP work?</a></li>
<li class="chapter" data-level="" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html#practice"><i class="fa fa-check"></i>Practice</a>
<ul>
<li class="chapter" data-level="" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html#example-1-iris"><i class="fa fa-check"></i>Example 1: iris</a></li>
<li class="chapter" data-level="" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html#implement-t-sne"><i class="fa fa-check"></i>Implement t-SNE</a></li>
<li class="chapter" data-level="" data-path="umap-and-t-sne.html"><a href="umap-and-t-sne.html#example-2-brechjes-participants"><i class="fa fa-check"></i>Example 2: Brechje’s participants</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="generating-interactive-notebooks.html"><a href="generating-interactive-notebooks.html"><i class="fa fa-check"></i><b>3</b> Generating interactive notebooks</a>
<ul>
<li class="chapter" data-level="" data-path="generating-interactive-notebooks.html"><a href="generating-interactive-notebooks.html#preparation-of-the-rmd"><i class="fa fa-check"></i>Preparation of the Rmd</a></li>
<li class="chapter" data-level="" data-path="generating-interactive-notebooks.html"><a href="generating-interactive-notebooks.html#converting-your-rmd-into-a-jupyter-notebook"><i class="fa fa-check"></i>Converting your Rmd into a Jupyter notebook</a></li>
<li class="chapter" data-level="" data-path="generating-interactive-notebooks.html"><a href="generating-interactive-notebooks.html#creating-a-github-repository-that-connects-to-binder"><i class="fa fa-check"></i>Creating a GitHub repository that connects to Binder</a></li>
<li class="chapter" data-level="3.1" data-path="generating-interactive-notebooks.html"><a href="generating-interactive-notebooks.html#outro"><i class="fa fa-check"></i><b>3.1</b> Outro</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Dimension Reduction with UMAP and t-SNE and how to create Interactive Notebooks - AcqVA Aurora workshop</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="umap-and-t-sne" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Section2</span> UMAP and t-SNE<a href="umap-and-t-sne.html#umap-and-t-sne" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This first part of the workshop will focus on dimension reduction using UMAP (Uniform Manifold Approximation and Projection) and t-SNE (t-Distributed Stochastic Neighbor Embedding).</p>
<p>UMAP (Uniform Manifold Approximation and Projection) <span class="citation">(<a href="#ref-mcinnes2018umap">McInnes, Healy, and Melville 2018</a>; <a href="#ref-becht2019dimensionality">Becht et al. 2019</a>; <a href="#ref-kobak2021initialization">Kobak and Linderman 2021</a>)</span> is a dimensionality reduction technique that is a state-of-the-art and method used for</p>
<ul>
<li>find latent variables (reducing the dimensionality of complex, high-dimensional data)<br />
</li>
<li>data visualization<br />
</li>
<li>identifying clusters of similar words</li>
</ul>
<p>It is particularly popular in machine learning and data analysis for tasks such as clustering, visualization, and feature engineering.</p>
<p>In contrast to many of the more traditional dimensionalty reduction methods that are based on matrix factorization like PCA or LDA (this is what we did in our first AcqVA AUrora Lab workshop on dimensionality reduction), UMAP and t-SNE are based on Neighbor Graphs (the dimensionality reduction is based on the relationship to nearest neighbors).</p>
<p>In linguistics UMAP and t-SNE it can be used to find latent variables, detect and identify clusters (e.g. of similar words, observations, or participants), and for visualizing complex, high-dimensional data in a way that preserves the inherent structure of the data.</p>
<p>Here’s a brief overview of UMAP and a comparison with PCA (Principal Component Analysis):</p>
<div id="comparison-between-umap-and-pca" class="section level3 unnumbered hasAnchor">
<h3>Comparison between UMAP and PCA<a href="umap-and-t-sne.html#comparison-between-umap-and-pca" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>UMAP is <strong>more flexible</strong> in terms of capturing nonlinear relationships and allowing for variable dimensionality.</p>
<p>UMAP is <strong>designed to better preserve</strong> both local and global structures in the data, making it more suitable for certain types of high-dimensional data, especially when the relationships are intricate and nonlinear.</p>
<p>UMAP can be <strong>computationally expensive</strong> for large data sets, while PCA is generally more computationally efficient (but UMAP probably has the best cost to quality rations of dimensionality reduction methods and it is far more efficent that e.g. t-SNE).</p>
<p>UMAP and PCA serve different purposes and are suitable for different scenarios. UMAP is a powerful tool for identifying clusters and visualizing high-dimensional data, especially when nonlinear relationships need to be preserved, while PCA is a computationally efficient technique for capturing the principal components and explaining variance in a linear manner if the datasets are not very complex.</p>
</div>
<div id="key-aspects-of-umap" class="section level3 unnumbered hasAnchor">
<h3>Key aspects of UMAP<a href="umap-and-t-sne.html#key-aspects-of-umap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Below is a summary of the main or key aspects of UMAP (with pointers to t-SNE):</p>
<ol style="list-style-type: decimal">
<li><p>UMAP is a <strong>nonlinear</strong> dimensionality reduction technique, meaning it can capture complex relationships in the data that linear methods such as PCA may struggle with. Linear dimensionality reduction methods assume that the relationships between the variables are linear. In other words, the data can be represented as a linear combination of its features. When using a linear method, the data is projected onto a lower-dimensional subspace via a linear transformation of the original space. UMAP and t-SNE do not assume that the relationship between variables is linear (in fact, they assume that the relationship is nonlinear), meaning that the projection onto a lower dimensional space is not linear. However, both methods focuses on preserving both local and global structure.</p></li>
<li><p>UMAP adheres to the <strong>Preservation of Neighborhoods</strong> principle and aims to maintain the local structure of the data points which means that points (observations) that are close in the high-dimensional space should remain close in the lower-dimensional representation.</p></li>
<li><p>UMAP is not restricted to reducing data to a fixed number of dimensions and it is thus assuming <strong>Variable Dimensionality</strong>. This means that UMAP (and t-SNE) allows for variable dimensionality, offering flexibility in the choice of the target dimensionality.</p></li>
<li><p>UMAP is more <strong>robust</strong> to noise and outliers compared to some other, linear, dimensionality reduction techniques, making it suitable for a wide range of data types. Also, while PCA works well when the majority of the variability is explained with the first few components, UMAP and t-SNE can handle data better where the variability is more spread out over more dimensions or components (or their equivalents).</p></li>
<li><p>Unlike some other nonlinear techniques, UMAP is designed to <strong>preserve structure</strong> in the data not only locally but also globally, providing a more comprehensive representation that aims to retain the relationship between data points. In contrast, other multidimensionalty reduction methods aim to capture variability or variance while compromising relative similarity.</p></li>
</ol>
</div>
<div id="what-are-differences-between-umap-and-t-sne" class="section level3 unnumbered hasAnchor">
<h3>What are differences between UMAP and t-SNE?<a href="umap-and-t-sne.html#what-are-differences-between-umap-and-t-sne" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>UMAP and t-SNE <span class="citation">(<a href="#ref-gisbrecht2015parametric">Gisbrecht, Schulz, and Hammer 2015</a>)</span> are very similar but have some differences. For instance,</p>
<ul>
<li>UMAP is substantively faster than t-SNE<br />
</li>
<li>UMAP always starts with the same low-dimensional graph (as it uses spectral embedding to generate the initial low-dimensional graph) while t-SNE generates different initial low-dimensional graphs for each run which leads to very different final low-dimensional graphs for each run!<br />
</li>
<li>UMAP is deemed to have a better balance between retaining local and global structure than t-SNE (see the projection of a mammoth on the pair-code blogpost on this issue <a href="https://pair-code.github.io/understanding-umap/">here</a>). In fact, t-SNE is better at preserving local structure than UMAP (but it doesn’t preserve global structure)<br />
</li>
<li>Another difference is that t-SNE moves <strong>each</strong> point a little bit during each iteration while UMAP only moves one point (or a small number of points) per iteration.</li>
</ul>
</div>
<div id="additional-accessible-resources" class="section level3 unnumbered hasAnchor">
<h3>Additional (accessible) resources<a href="umap-and-t-sne.html#additional-accessible-resources" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The scientific literature on UMAP and t-SNE is very technical and requires substantive knowledge of advanced algebra. Here are thus some links to easy to follow and very useful resources that you can check out to get an idea of how UMAP and t-SNE orks:</p>
<p><strong>UMAP</strong></p>
<ul>
<li><p><em>UMAP Dimension Reduction, Main Ideas!!!</em> by
StatQuest with Josh Starmer (<a href="https://www.youtube.com/watch?v=eN0wFzBA4Sc">YouTube tutorial</a>)<br />
</p></li>
<li><p><em>UMAP: Mathematical Details (clearly explained!!!)</em> by
StatQuest with Josh Starmer (<a href="https://www.youtube.com/watch?v=jth4kEvJ3P8&amp;t=314s">YouTube tutorial</a>)</p></li>
<li><p><em>UMAP Uniform Manifold Approximation and Projection for Dimension Reduction | SciPy 2018 |</em> by Enthought
(<a href="https://www.youtube.com/watch?v=nq6iPZVUxZU">YouTube tutorial</a>)</p></li>
<li><p><em>UMAP explained | The best dimensionality reduction?</em> by
AI Coffee Break with Letitia (<a href="https://www.youtube.com/watch?v=6BPl81wGGP8">YouTube tutorial</a>)</p></li>
</ul>
<p><strong>t-SNE</strong></p>
<ul>
<li><em>StatQuest: t-SNE, Clearly Explained</em> by
StatQuest with Josh Starmer (<a href="https://www.youtube.com/watch?v=NEaUSP4YerM">YouTube tutorial</a>)<br />
</li>
<li><em>t-SNE Simply Explained</em> by
ritvikmath (<a href="https://www.youtube.com/watch?v=00TSeKZyeXQ">YouTube tutorial</a>)</li>
</ul>
<p><strong>Gradient descent</strong></p>
<ul>
<li><em>Gradient Descent, Step-by-Step</em> by
StatQuest with Josh Starmer (<a href="https://www.youtube.com/watch?v=sDv4f4s2SB8">YouTube tutorial</a>)</li>
</ul>
</div>
<div id="how-does-umap-work" class="section level3 unnumbered hasAnchor">
<h3>How does UMAP work?<a href="umap-and-t-sne.html#how-does-umap-work" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The basic idea of UMAP is that a higher-dimensional graph is mapped onto a lower dimensional graph. During this projection, the relationship between individual points (local structure) as well as between groups of points (global structure) is retained as well as possible (observations and clusters of observations that are close together in high-dimensional space should also be close together in low-dimensional space).</p>
<blockquote>
<p>What does this mean? Imagine a group of people in a room where you can identify some small groups of people that form a pattern. The idea is that UMAP displays the data in a way that the individual groups are preserved but also their pattern in the room.</p>
</blockquote>
<p>How is this done though? UMAP works with so-called simpelxes which are connections between points. The idea is that we can “rebuilt” the complex structure just based on these simpelxes.</p>
<p><img src="bookdownproj_files/figure-html/simplex-1.png" width="672" /></p>
<p>UMAP starts by creating a distance matrix where the distance between each data point is calculated to all other data points.</p>
<p>Then, a similarity score is calculated for each point. The similarity score is calculated as e<sup>-(raw distance - distance to nearest neighbor) / <span class="math inline">\(\sigma\)</span></sup>. The similarity score depends on the number of neighbors (k) that are specified (this number includes the point itself!). The similarity score first uses the distance and then draws a curve or area around the points so that the total of the points position matches a similarity score that is the log<sub>2</sub>(k) - this means that the curve or area differs for each point. For example, if we have a cluster of points A, B, and C and we set k = 3 and the distance between A and B is 0.5 and the distance between A and C is 2.4 and the log<sub>2</sub>(3) is 1.6. Then, the curve will be drawn in a way that the curve is 1 high above point B and 0.6 above point C. The curve or area is not symmetric as otherwise some points would not have any neighbors in their allocated area. For example, the value of B relative to C can be (and probably is) different from the score of C relative to B.</p>
<p>Figure with shape and points at irregular distances to show how simplexes would reflect the global structure.</p>
<p><img src="bookdownproj_files/figure-html/simplex2-1.png" width="672" /></p>
<p>The fact that UMAP adapts or sets the curve or area for each data points allows us to guarantee that all points have exactly k neighbors in their area of influence and that all sums of similarities are log<sub>2</sub>(k) (thus rendering the distribution uniform in a mathematical sense). Other points do not matter and have a similarity score of 0 - this is important as it reduced the number of values for each data point from all data points (in the distance matrix) to k similarity scores for each point.</p>
<p>In a next step, the similarity scores are scaled so that they are symmetric again (similar to averaging the similarity scores) when similarity scores differ. For example, the value of B relative to C could be 0.6 while the score of C relative to B could be 1.0. This would then result in a similarity score of 0.8 for both B relative to C and C relative to B.</p>
<p>Now, UMAP generates an initial low-dimensional graph using spectral embedding. This graph will, however, not capture the global structure well. To adapt the initial graph, UMAP iteratively selects random pairs of points with a probability of being chosen based on their similarity score (higher similarity pairs are more likely to be chosen). Then, UMAP moves one point closer to the other - the choice which point is moved is random. Once it is determined which point is moved, UMAP selects a point from another cluster and moves the point in question further away from the foreign cluster point and closer to the same cluster point.</p>
<p>The question now is how much the point should be moved. For this, UMAP calculates similarity scores for the same-cluster points and the point to be moved and the foreign cluster point. This similarity score is based on a fixed distribution (the t-distribution). The aim of moving the point is to maximize the low-dimensional value for similar, same cluster points and to minimize the value of foreign cluster, dissimilar points. The idea is that the distance between the same cluster point should be minimized while the distance to the other-cluster point should be maximized. The perfect ratio between minimization and maximization is determined by gradient descent.</p>
<p>This is done iteratively until we arrive at a final low-dimensional graph. The structure of the final graph is determined to a large extent by the number of nearest neighbors (k) one chooses: a lower k will lead to smaller clusters and preservation of local structure while higher k will lead to larger clusters and preservation of global structure.</p>
</div>
<div id="practice" class="section level2 unnumbered hasAnchor">
<h2>Practice<a href="umap-and-t-sne.html#practice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We start with a very simple example and then move on to a more realistic example. The initial easy study simply aims at showing you the relevant functions.</p>
<p>We now activate the packages that we need for the dimensionality reduction methods.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="umap-and-t-sne.html#cb1-1" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-2"><a href="umap-and-t-sne.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-3"><a href="umap-and-t-sne.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="umap-and-t-sne.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-5"><a href="umap-and-t-sne.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(umap)</span>
<span id="cb1-6"><a href="umap-and-t-sne.html#cb1-6" tabindex="-1"></a><span class="fu">library</span>(tsne)</span>
<span id="cb1-7"><a href="umap-and-t-sne.html#cb1-7" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div id="example-1-iris" class="section level3 unnumbered hasAnchor">
<h3>Example 1: iris<a href="umap-and-t-sne.html#example-1-iris" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In our first very basic example, we will use the <code>iris</code> data set.</p>
<blockquote>
<p>This famous (Fisher’s or Anderson’s) iris data set gives the measurements in centimeters of the variables sepal length and width and petal length and width, respectively, for 50 flowers from each of 3 species of iris. The species are Iris setosa, versicolor, and virginica.</p>
</blockquote>
<p>We simply load this pre-installed data set by calling the <code>data</code> function and add <code>"iris"</code> as its argument. We also inspect the data using the <code>head</code> (which displays the first 6 rows of the data set) and the <code>str</code> function (which summarized the structure of the data set).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="umap-and-t-sne.html#cb2-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;iris&quot;</span>)</span>
<span id="cb2-2"><a href="umap-and-t-sne.html#cb2-2" tabindex="-1"></a><span class="co"># inspect </span></span>
<span id="cb2-3"><a href="umap-and-t-sne.html#cb2-3" tabindex="-1"></a><span class="fu">head</span>(iris); <span class="fu">str</span>(iris)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa</code></pre>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>We now process data and separate the features from the labels. As with simpler dimension reduction methods such as PCA and MDS, UMAP and t-SNE only work on numeric data. We can and will, however, add additional information again later for the visualization (this is why we save the labels).</p>
<p>As a tip if you are working with factors or character variables: you can convert factors and character variables into numeric dummy variables where the presence or absence of a level is indicated by <code>1</code> versus <code>0</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="umap-and-t-sne.html#cb5-1" tabindex="-1"></a><span class="co"># extract</span></span>
<span id="cb5-2"><a href="umap-and-t-sne.html#cb5-2" tabindex="-1"></a>features <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="umap-and-t-sne.html#cb5-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Species)</span>
<span id="cb5-4"><a href="umap-and-t-sne.html#cb5-4" tabindex="-1"></a><span class="co"># extract labels</span></span>
<span id="cb5-5"><a href="umap-and-t-sne.html#cb5-5" tabindex="-1"></a>label <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="umap-and-t-sne.html#cb5-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Species)</span>
<span id="cb5-7"><a href="umap-and-t-sne.html#cb5-7" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb5-8"><a href="umap-and-t-sne.html#cb5-8" tabindex="-1"></a><span class="fu">str</span>(features); <span class="fu">str</span>(label)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  4 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...</code></pre>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  1 variable:
##  $ Species: Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>This is all we need to do in terms of data processing.</p>
<div id="implement-umap" class="section level4 unnumbered hasAnchor">
<h4>Implement UMAP<a href="umap-and-t-sne.html#implement-umap" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can now implement the UMAP. UMAP has many arguments but the most important are:<br />
+ <code>x</code>: the data frame or matrix of features we want to reduce
+ <code>n_neighbors</code>: this the number of neighbors that are considered (k). The higher the number of neighbors, the bigger the groups and the more global structure is retained.
+ <code>n_components</code>: the number of target dimensions the complex data set is summarized into (2 means that the data will be compressed into 2 dimensions).</p>
<p>The argument <code>random_state</code> is simply the seed used to keep track of the random number generator during UMAP - this argument is not essential.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="umap-and-t-sne.html#cb8-1" tabindex="-1"></a>umap.res <span class="ot">&lt;-</span> <span class="fu">umap</span>(features, <span class="co"># the data set containing the features </span></span>
<span id="cb8-2"><a href="umap-and-t-sne.html#cb8-2" tabindex="-1"></a>                 <span class="at">n_neighbors =</span> <span class="dv">15</span>, <span class="co"># number of nearest neighbors</span></span>
<span id="cb8-3"><a href="umap-and-t-sne.html#cb8-3" tabindex="-1"></a>                 <span class="at">n_components =</span> <span class="dv">2</span>, <span class="co"># number of target dimensions </span></span>
<span id="cb8-4"><a href="umap-and-t-sne.html#cb8-4" tabindex="-1"></a>                 <span class="at">random_state =</span> <span class="dv">15</span> <span class="co"># seed for random number generation used during umap</span></span>
<span id="cb8-5"><a href="umap-and-t-sne.html#cb8-5" tabindex="-1"></a>                 ) </span>
<span id="cb8-6"><a href="umap-and-t-sne.html#cb8-6" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb8-7"><a href="umap-and-t-sne.html#cb8-7" tabindex="-1"></a><span class="fu">str</span>(umap.res)</span></code></pre></div>
<pre><code>## List of 4
##  $ layout: num [1:150, 1:2] 8.57 9.3 8.65 8.66 8.74 ...
##  $ data  : num [1:150, 1:4] 5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : NULL
##   .. ..$ : chr [1:4] &quot;Sepal.Length&quot; &quot;Sepal.Width&quot; &quot;Petal.Length&quot; &quot;Petal.Width&quot;
##  $ knn   :List of 2
##   ..$ indexes  : int [1:150, 1:15] 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ distances: num [1:150, 1:15] 0 0 0 0 0 0 0 0 0 0 ...
##   ..- attr(*, &quot;class&quot;)= chr &quot;umap.knn&quot;
##  $ config:List of 24
##   ..$ n_neighbors         : int 15
##   ..$ n_components        : int 2
##   ..$ metric              : chr &quot;euclidean&quot;
##   ..$ n_epochs            : int 200
##   ..$ input               : chr &quot;data&quot;
##   ..$ init                : chr &quot;spectral&quot;
##   ..$ min_dist            : num 0.1
##   ..$ set_op_mix_ratio    : num 1
##   ..$ local_connectivity  : num 1
##   ..$ bandwidth           : num 1
##   ..$ alpha               : num 1
##   ..$ gamma               : num 1
##   ..$ negative_sample_rate: int 5
##   ..$ a                   : num 1.58
##   ..$ b                   : num 0.895
##   ..$ spread              : num 1
##   ..$ random_state        : int 15
##   ..$ transform_state     : int NA
##   ..$ knn                 : logi NA
##   ..$ knn_repeats         : num 1
##   ..$ verbose             : logi FALSE
##   ..$ umap_learn_args     : logi NA
##   ..$ method              : chr &quot;naive&quot;
##   ..$ metric.function     :function (m, origin, targets)  
##   ..- attr(*, &quot;class&quot;)= chr &quot;umap.config&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;umap&quot;</code></pre>
<p>In order to visualize the data, we only need to extract or retain information from the <code>layout</code> list item which is then converted into a data frame. Also, we add the labels that we extracted earlier.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="umap-and-t-sne.html#cb10-1" tabindex="-1"></a>visdat <span class="ot">&lt;-</span> umap.res[[<span class="st">&quot;layout&quot;</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="umap-and-t-sne.html#cb10-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="umap-and-t-sne.html#cb10-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(label)</span>
<span id="cb10-4"><a href="umap-and-t-sne.html#cb10-4" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb10-5"><a href="umap-and-t-sne.html#cb10-5" tabindex="-1"></a><span class="fu">str</span>(visdat)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  3 variables:
##  $ V1     : num  8.57 9.3 8.65 8.66 8.74 ...
##  $ V2     : num  -0.2222 1.592 1.436 1.707 -0.0237 ...
##  $ Species: Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>We can now visualize the UMAP results.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="umap-and-t-sne.html#cb12-1" tabindex="-1"></a>visdat <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="umap-and-t-sne.html#cb12-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="umap-and-t-sne.html#cb12-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-4"><a href="umap-and-t-sne.html#cb12-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/visuamp1-1.png" width="672" /></p>
<p>We can see that the resulting graph neatly differentiates the different species of iris based on their features with setosa being more different from versicolor and virginica on dimension 1. versicolor and virginica are differentiated neatly on dimension 2.</p>
<p>We now implement the t-SNE dimension reduction.</p>
</div>
</div>
<div id="implement-t-sne" class="section level3 unnumbered hasAnchor">
<h3>Implement t-SNE<a href="umap-and-t-sne.html#implement-t-sne" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As we can use the data we processed for UMAP. we can start by implementing t-SNE right away.</p>
<p>The <code>tsne</code> function has<br />
+ <code>x</code>: the data frame or matrix of features we want to reduce<br />
+ <code>k</code>: the number of target dimensions the complex data set is summarized into (2 means that the data will be compressed into 2 dimensions).<br />
+ <code>perplexity</code>: the number of neighbors used in the reduction (like <code>n_neighbors</code> in UMAP)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="umap-and-t-sne.html#cb13-1" tabindex="-1"></a>tsne.res <span class="ot">&lt;-</span> <span class="fu">tsne</span>(features, <span class="co"># the data set containing the features </span></span>
<span id="cb13-2"><a href="umap-and-t-sne.html#cb13-2" tabindex="-1"></a>                 <span class="at">k =</span><span class="dv">2</span>, <span class="co"># number of target dimensions (dimensions of the resulting embedding</span></span>
<span id="cb13-3"><a href="umap-and-t-sne.html#cb13-3" tabindex="-1"></a>                 <span class="at">perplexity =</span> <span class="dv">15</span> <span class="co"># number of nearest neighbors</span></span>
<span id="cb13-4"><a href="umap-and-t-sne.html#cb13-4" tabindex="-1"></a>                 ) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="umap-and-t-sne.html#cb13-5" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="umap-and-t-sne.html#cb13-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(label)</span></code></pre></div>
<pre><code>## sigma summary: Min. : 0.371156402817891 |1st Qu. : 0.483451059893582 |Median : 0.517217282896284 |Mean : 0.52578781673612 |3rd Qu. : 0.55783286579441 |Max. : 0.726992613548635 |</code></pre>
<pre><code>## Epoch: Iteration #100 error is: 13.9650190844777</code></pre>
<pre><code>## Epoch: Iteration #200 error is: 0.315665746699505</code></pre>
<pre><code>## Epoch: Iteration #300 error is: 0.305251514045166</code></pre>
<pre><code>## Epoch: Iteration #400 error is: 0.301715472086119</code></pre>
<pre><code>## Epoch: Iteration #500 error is: 0.300180476112018</code></pre>
<pre><code>## Epoch: Iteration #600 error is: 0.299308409324969</code></pre>
<pre><code>## Epoch: Iteration #700 error is: 0.298723065896091</code></pre>
<pre><code>## Epoch: Iteration #800 error is: 0.298327733101495</code></pre>
<pre><code>## Epoch: Iteration #900 error is: 0.298096995952058</code></pre>
<pre><code>## Epoch: Iteration #1000 error is: 0.297776411082323</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="umap-and-t-sne.html#cb25-1" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb25-2"><a href="umap-and-t-sne.html#cb25-2" tabindex="-1"></a><span class="fu">str</span>(tsne.res)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  3 variables:
##  $ V1     : num  4.52 9.05 2.99 -1.84 1.8 ...
##  $ V2     : num  -34.5 -25.7 -27.6 -26.5 -35.8 ...
##  $ Species: Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>We now visualize t-SNE results.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="umap-and-t-sne.html#cb27-1" tabindex="-1"></a>tsne.res <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="umap-and-t-sne.html#cb27-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb27-3"><a href="umap-and-t-sne.html#cb27-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb27-4"><a href="umap-and-t-sne.html#cb27-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/vistsne1-1.png" width="672" /></p>
<p>We can see that although UMAP and t-SNE are mathematically very similar, their results can differ notably.</p>
<p>We now turn to a more complex example using a real world data set.</p>
</div>
<div id="example-2-brechjes-participants" class="section level3 unnumbered hasAnchor">
<h3>Example 2: Brechje’s participants<a href="umap-and-t-sne.html#example-2-brechjes-participants" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This data set was send in by Brechje and we can use it here to show how we can examine participants. In my own work I use methods like UMAP when I work with word embeddings to find similarity in parts of speech.</p>
<p>In a first step, we load the data using the <code>read_xlsx</code> function from the <code>readxl</code> package and inspect it using <code>head</code> and the <code>str</code> function.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="umap-and-t-sne.html#cb28-1" tabindex="-1"></a>bdat  <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">readRDS</span>(<span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;bdat.rda&quot;</span>))</span>
<span id="cb28-2"><a href="umap-and-t-sne.html#cb28-2" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb28-3"><a href="umap-and-t-sne.html#cb28-3" tabindex="-1"></a><span class="fu">head</span>(bdat); <span class="fu">str</span>(bdat)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 52
##   Participant_Private_ID Event_Index.x Trial_Number Reaction_Time display  Item 
##   &lt;chr&gt;                          &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 5826131                          129            3          547. sentence 42   
## 2 5826131                          130            3          506  sentence 42   
## 3 5826131                          131            3          731  sentence 42   
## 4 5826131                          132            3          539  sentence 42   
## 5 5826131                          159            5          474. sentence 40   
## 6 5826131                          160            5          532  sentence 40   
## # ℹ 46 more variables: Version &lt;chr&gt;, sentence &lt;chr&gt;, target_structure &lt;chr&gt;,
## #   poss_domain &lt;chr&gt;, gender_pronoun &lt;chr&gt;, version_description &lt;chr&gt;,
## #   critical_section &lt;chr&gt;, section_number &lt;chr&gt;,
## #   section_rel_to_critical &lt;chr&gt;, Language &lt;chr&gt;, Language_group &lt;chr&gt;,
## #   N_back_correct &lt;chr&gt;, ten_or_more_errors_CQ &lt;chr&gt;, sex_quantised &lt;chr&gt;,
## #   age &lt;chr&gt;, level_education_quantised &lt;chr&gt;, nr_people_household_NL &lt;chr&gt;,
## #   calc_total_hours_classes &lt;chr&gt;, total_months_in_NO &lt;chr&gt;, …</code></pre>
<pre><code>## tibble [38,208 × 52] (S3: tbl_df/tbl/data.frame)
##  $ Participant_Private_ID                    : chr [1:38208] &quot;5826131&quot; &quot;5826131&quot; &quot;5826131&quot; &quot;5826131&quot; ...
##  $ Event_Index.x                             : num [1:38208] 129 130 131 132 159 160 161 162 186 187 ...
##  $ Trial_Number                              : num [1:38208] 3 3 3 3 5 5 5 5 7 7 ...
##  $ Reaction_Time                             : num [1:38208] 547 506 731 539 474 ...
##  $ display                                   : chr [1:38208] &quot;sentence&quot; &quot;sentence&quot; &quot;sentence&quot; &quot;sentence&quot; ...
##  $ Item                                      : chr [1:38208] &quot;42&quot; &quot;42&quot; &quot;42&quot; &quot;42&quot; ...
##  $ Version                                   : chr [1:38208] &quot;Baseline&quot; &quot;Baseline&quot; &quot;Baseline&quot; &quot;Baseline&quot; ...
##  $ sentence                                  : chr [1:38208] &quot;Nathan er ikke glad i Ã¥ lese bÃ¸ker. Men han leser for sÃ¸nnen sin pÃ¥ soverommet hver sÃ¸ndag.&quot; &quot;Nathan er ikke glad i Ã¥ lese bÃ¸ker. Men han leser for sÃ¸nnen sin pÃ¥ soverommet hver sÃ¸ndag.&quot; &quot;Nathan er ikke glad i Ã¥ lese bÃ¸ker. Men han leser for sÃ¸nnen sin pÃ¥ soverommet hver sÃ¸ndag.&quot; &quot;Nathan er ikke glad i Ã¥ lese bÃ¸ker. Men han leser for sÃ¸nnen sin pÃ¥ soverommet hver sÃ¸ndag.&quot; ...
##  $ target_structure                          : chr [1:38208] &quot;possessives&quot; &quot;possessives&quot; &quot;possessives&quot; &quot;possessives&quot; ...
##  $ poss_domain                               : chr [1:38208] &quot;local&quot; &quot;local&quot; &quot;local&quot; &quot;local&quot; ...
##  $ gender_pronoun                            : chr [1:38208] &quot;masculine&quot; &quot;masculine&quot; &quot;masculine&quot; &quot;masculine&quot; ...
##  $ version_description                       : chr [1:38208] &quot;gram_match&quot; &quot;gram_match&quot; &quot;gram_match&quot; &quot;gram_match&quot; ...
##  $ critical_section                          : chr [1:38208] &quot;6&quot; &quot;6&quot; &quot;6&quot; &quot;6&quot; ...
##  $ section_number                            : chr [1:38208] &quot;6&quot; &quot;7&quot; &quot;8&quot; &quot;9&quot; ...
##  $ section_rel_to_critical                   : chr [1:38208] &quot;0&quot; &quot;1&quot; &quot;2&quot; &quot;3&quot; ...
##  $ Language                                  : chr [1:38208] &quot;English&quot; &quot;English&quot; &quot;English&quot; &quot;English&quot; ...
##  $ Language_group                            : chr [1:38208] &quot;Dutch &amp; English&quot; &quot;Dutch &amp; English&quot; &quot;Dutch &amp; English&quot; &quot;Dutch &amp; English&quot; ...
##  $ N_back_correct                            : chr [1:38208] &quot;-0.327014686531458&quot; &quot;-0.327014686531458&quot; &quot;-0.327014686531458&quot; &quot;-0.327014686531458&quot; ...
##  $ ten_or_more_errors_CQ                     : chr [1:38208] &quot;no&quot; &quot;no&quot; &quot;no&quot; &quot;no&quot; ...
##  $ sex_quantised                             : chr [1:38208] &quot;male&quot; &quot;male&quot; &quot;male&quot; &quot;male&quot; ...
##  $ age                                       : chr [1:38208] &quot;1.32184690747597&quot; &quot;1.32184690747597&quot; &quot;1.32184690747597&quot; &quot;1.32184690747597&quot; ...
##  $ level_education_quantised                 : chr [1:38208] &quot;1.75727437922403&quot; &quot;1.75727437922403&quot; &quot;1.75727437922403&quot; &quot;1.75727437922403&quot; ...
##  $ nr_people_household_NL                    : chr [1:38208] &quot;1.28345988947719&quot; &quot;1.28345988947719&quot; &quot;1.28345988947719&quot; &quot;1.28345988947719&quot; ...
##  $ calc_total_hours_classes                  : chr [1:38208] &quot;-0.411360284829124&quot; &quot;-0.411360284829124&quot; &quot;-0.411360284829124&quot; &quot;-0.411360284829124&quot; ...
##  $ total_months_in_NO                        : chr [1:38208] &quot;1.35893483419755&quot; &quot;1.35893483419755&quot; &quot;1.35893483419755&quot; &quot;1.35893483419755&quot; ...
##  $ AoA_Norwegian                             : chr [1:38208] &quot;1.67522181987997&quot; &quot;1.67522181987997&quot; &quot;1.67522181987997&quot; &quot;1.67522181987997&quot; ...
##  $ AoA_ENG                                   : logi [1:38208] NA NA NA NA NA NA ...
##  $ SRP_NOR                                   : chr [1:38208] &quot;-0.870449870957041&quot; &quot;-0.870449870957041&quot; &quot;-0.870449870957041&quot; &quot;-0.870449870957041&quot; ...
##  $ SRP_ENG                                   : logi [1:38208] NA NA NA NA NA NA ...
##  $ NOR_prof_test                             : chr [1:38208] &quot;0.333832653789489&quot; &quot;0.333832653789489&quot; &quot;0.333832653789489&quot; &quot;0.333832653789489&quot; ...
##  $ ENG_prof_test                             : chr [1:38208] &quot;1.10637055048618&quot; &quot;1.10637055048618&quot; &quot;1.10637055048618&quot; &quot;1.10637055048618&quot; ...
##  $ proportion_daily_NOR_use                  : chr [1:38208] &quot;-1.1593398957075&quot; &quot;-1.1593398957075&quot; &quot;-1.1593398957075&quot; &quot;-1.1593398957075&quot; ...
##  $ proportion_daily_NL_use                   : chr [1:38208] &quot;1.57558800440357&quot; &quot;1.57558800440357&quot; &quot;1.57558800440357&quot; &quot;1.57558800440357&quot; ...
##  $ proportion_daily_ENG_use                  : logi [1:38208] NA NA NA NA NA NA ...
##  $ proportion_use_work_study_NOR             : chr [1:38208] &quot;-1.76908003530535&quot; &quot;-1.76908003530535&quot; &quot;-1.76908003530535&quot; &quot;-1.76908003530535&quot; ...
##  $ proportion_use_work_study_NL              : chr [1:38208] &quot;2.79865248019327&quot; &quot;2.79865248019327&quot; &quot;2.79865248019327&quot; &quot;2.79865248019327&quot; ...
##  $ proportion_use_work_study_ENG             : chr [1:38208] &quot;-0.660153999087998&quot; &quot;-0.660153999087998&quot; &quot;-0.660153999087998&quot; &quot;-0.660153999087998&quot; ...
##  $ proportion_use_home_partner_kids_NOR      : chr [1:38208] &quot;-0.84118482632202&quot; &quot;-0.84118482632202&quot; &quot;-0.84118482632202&quot; &quot;-0.84118482632202&quot; ...
##  $ proportion_use_home_partner_kids_NL       : chr [1:38208] &quot;1.09276413764443&quot; &quot;1.09276413764443&quot; &quot;1.09276413764443&quot; &quot;1.09276413764443&quot; ...
##  $ proportion_use_home_partner_kids_ENG      : chr [1:38208] &quot;-0.40166479402391&quot; &quot;-0.40166479402391&quot; &quot;-0.40166479402391&quot; &quot;-0.40166479402391&quot; ...
##  $ proportion_use_friends_family_NOR         : chr [1:38208] &quot;1.66969949897901&quot; &quot;1.66969949897901&quot; &quot;1.66969949897901&quot; &quot;1.66969949897901&quot; ...
##  $ proportion_use_friends_family_NL          : chr [1:38208] &quot;-1.42873323812108&quot; &quot;-1.42873323812108&quot; &quot;-1.42873323812108&quot; &quot;-1.42873323812108&quot; ...
##  $ proportion_use_friends_family_ENG         : chr [1:38208] &quot;-0.599559348328312&quot; &quot;-0.599559348328312&quot; &quot;-0.599559348328312&quot; &quot;-0.599559348328312&quot; ...
##  $ average_proportion_use_across_contexts_NOR: chr [1:38208] &quot;0.2857142857142857&quot; &quot;0.2857142857142857&quot; &quot;0.2857142857142857&quot; &quot;0.2857142857142857&quot; ...
##  $ last_use_English_quantised                : chr [1:38208] &quot;-0.755548752207392&quot; &quot;-0.755548752207392&quot; &quot;-0.755548752207392&quot; &quot;-0.755548752207392&quot; ...
##  $ codeswitching_quantised                   : chr [1:38208] &quot;-1.44661386861583&quot; &quot;-1.44661386861583&quot; &quot;-1.44661386861583&quot; &quot;-1.44661386861583&quot; ...
##  $ sum_prof_other_l_possessum_agr            : chr [1:38208] &quot;-0.155181415862062&quot; &quot;-0.155181415862062&quot; &quot;-0.155181415862062&quot; &quot;-0.155181415862062&quot; ...
##  $ sum_prof_other_l_possessor_agr            : chr [1:38208] &quot;-0.583182374297833&quot; &quot;-0.583182374297833&quot; &quot;-0.583182374297833&quot; &quot;-0.583182374297833&quot; ...
##  $ sum_use_other_l_possessum_agr             : num [1:38208] 0 0 0 0 0 0 0 0 0 0 ...
##  $ sum_use_other_l_possessor_agr             : num [1:38208] 0 0 0 0 0 0 0 0 0 0 ...
##  $ avg                                       : num [1:38208] 665 665 665 665 689 ...
##  $ stdev                                     : num [1:38208] 246 246 246 246 200 ...</code></pre>
<p>In a next step, we select the columns that we need (only numeric variables plus the factors that can be used as labels) and separate labels from features.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="umap-and-t-sne.html#cb31-1" tabindex="-1"></a><span class="co"># extract features</span></span>
<span id="cb31-2"><a href="umap-and-t-sne.html#cb31-2" tabindex="-1"></a>bfeatures <span class="ot">&lt;-</span> bdat[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">17</span>, <span class="dv">21</span><span class="sc">:</span><span class="dv">50</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="umap-and-t-sne.html#cb31-3" tabindex="-1"></a>  <span class="co"># remove columns</span></span>
<span id="cb31-4"><a href="umap-and-t-sne.html#cb31-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>AoA_ENG,<span class="sc">-</span>SRP_ENG,<span class="sc">-</span>proportion_daily_ENG_use, <span class="sc">-</span>average_proportion_use_across_contexts_NOR) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="umap-and-t-sne.html#cb31-5" tabindex="-1"></a>  <span class="co"># remove duplicates</span></span>
<span id="cb31-6"><a href="umap-and-t-sne.html#cb31-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="umap-and-t-sne.html#cb31-7" tabindex="-1"></a>  <span class="co"># remove column with NAs</span></span>
<span id="cb31-8"><a href="umap-and-t-sne.html#cb31-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="umap-and-t-sne.html#cb31-9" tabindex="-1"></a>  <span class="co"># clean Language group</span></span>
<span id="cb31-10"><a href="umap-and-t-sne.html#cb31-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Language_group =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(Language_group, <span class="st">&quot; &quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="umap-and-t-sne.html#cb31-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Language_group =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(Language_group, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">&amp;&quot;</span>)) </span>
<span id="cb31-12"><a href="umap-and-t-sne.html#cb31-12" tabindex="-1"></a><span class="co"># extract labels</span></span>
<span id="cb31-13"><a href="umap-and-t-sne.html#cb31-13" tabindex="-1"></a>blabel <span class="ot">&lt;-</span> <span class="fu">paste0</span>(bfeatures<span class="sc">$</span>Language_group, <span class="st">&quot;_&quot;</span>,</span>
<span id="cb31-14"><a href="umap-and-t-sne.html#cb31-14" tabindex="-1"></a>                 bfeatures<span class="sc">$</span>Participant_Private_ID) </span>
<span id="cb31-15"><a href="umap-and-t-sne.html#cb31-15" tabindex="-1"></a><span class="co"># remove label column from features</span></span>
<span id="cb31-16"><a href="umap-and-t-sne.html#cb31-16" tabindex="-1"></a>bfeatures <span class="ot">&lt;-</span> bfeatures <span class="sc">%&gt;%</span></span>
<span id="cb31-17"><a href="umap-and-t-sne.html#cb31-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Participant_Private_ID, <span class="sc">-</span>Language_group) <span class="sc">%&gt;%</span></span>
<span id="cb31-18"><a href="umap-and-t-sne.html#cb31-18" tabindex="-1"></a>  <span class="co"># convert characters to numbers</span></span>
<span id="cb31-19"><a href="umap-and-t-sne.html#cb31-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(is.character, as.numeric)</span>
<span id="cb31-20"><a href="umap-and-t-sne.html#cb31-20" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb31-21"><a href="umap-and-t-sne.html#cb31-21" tabindex="-1"></a><span class="fu">head</span>(bfeatures); <span class="fu">str</span>(bfeatures)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 26
##       age level_education_quanti…¹ nr_people_household_NL calc_total_hours_cla…²
##     &lt;dbl&gt;                    &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;
## 1  1.32                      1.76                  1.28                  -0.411 
## 2  1.32                      1.76                  1.28                  -0.684 
## 3 -0.128                    -0.593                 1.28                  -0.563 
## 4 -0.0474                    1.76                  1.28                   0.0431
## 5 -0.531                     0.582                -0.0356                 0.770 
## 6 -0.853                    -0.593                -0.0356                -0.684 
## # ℹ abbreviated names: ¹​level_education_quantised, ²​calc_total_hours_classes
## # ℹ 22 more variables: total_months_in_NO &lt;dbl&gt;, AoA_Norwegian &lt;dbl&gt;,
## #   SRP_NOR &lt;dbl&gt;, NOR_prof_test &lt;dbl&gt;, ENG_prof_test &lt;dbl&gt;,
## #   proportion_daily_NOR_use &lt;dbl&gt;, proportion_daily_NL_use &lt;dbl&gt;,
## #   proportion_use_work_study_NOR &lt;dbl&gt;, proportion_use_work_study_NL &lt;dbl&gt;,
## #   proportion_use_work_study_ENG &lt;dbl&gt;,
## #   proportion_use_home_partner_kids_NOR &lt;dbl&gt;, …</code></pre>
<pre><code>## tibble [155 × 26] (S3: tbl_df/tbl/data.frame)
##  $ age                                 : num [1:155] 1.3218 1.3218 -0.1279 -0.0474 -0.5306 ...
##  $ level_education_quantised           : num [1:155] 1.757 1.757 -0.593 1.757 0.582 ...
##  $ nr_people_household_NL              : num [1:155] 1.2835 1.2835 1.2835 1.2835 -0.0356 ...
##  $ calc_total_hours_classes            : num [1:155] -0.4114 -0.684 -0.5629 0.0431 0.7703 ...
##  $ total_months_in_NO                  : num [1:155] 1.3589 2.1973 0.0967 0.3086 -0.797 ...
##  $ AoA_Norwegian                       : num [1:155] 1.675 0.199 -0.012 0.269 0.55 ...
##  $ SRP_NOR                             : num [1:155] -0.87 1.026 0.183 -0.238 0.394 ...
##  $ NOR_prof_test                       : num [1:155] 0.334 1.206 0.267 -0.404 1.072 ...
##  $ ENG_prof_test                       : num [1:155] 1.11 1.11 1.11 1.11 1.11 ...
##  $ proportion_daily_NOR_use            : num [1:155] -1.159 0.272 -0.802 -1.696 0.272 ...
##  $ proportion_daily_NL_use             : num [1:155] 1.5756 0.0387 1.1914 2.1519 0.0387 ...
##  $ proportion_use_work_study_NOR       : num [1:155] -1.77 1.03 -1.77 -1.07 1.03 ...
##  $ proportion_use_work_study_NL        : num [1:155] 2.799 -0.542 2.799 1.964 -0.542 ...
##  $ proportion_use_work_study_ENG       : num [1:155] -0.66 -0.66 -0.66 -0.66 -0.66 ...
##  $ proportion_use_home_partner_kids_NOR: num [1:155] -0.841 -0.841 -0.841 -0.841 -0.841 ...
##  $ proportion_use_home_partner_kids_NL : num [1:155] 1.09 1.09 1.09 1.09 1.09 ...
##  $ proportion_use_home_partner_kids_ENG: num [1:155] -0.402 -0.402 -0.402 -0.402 -0.402 ...
##  $ proportion_use_friends_family_NOR   : num [1:155] 1.67 1.67 0.992 -1.042 1.67 ...
##  $ proportion_use_friends_family_NL    : num [1:155] -1.429 -1.429 -0.724 1.391 -1.429 ...
##  $ proportion_use_friends_family_ENG   : num [1:155] -0.6 -0.6 -0.6 -0.6 -0.6 ...
##  $ last_use_English_quantised          : num [1:155] -0.756 -0.756 -0.756 -0.756 -0.756 ...
##  $ codeswitching_quantised             : num [1:155] -1.447 2.025 2.025 -1.447 0.868 ...
##  $ sum_prof_other_l_possessum_agr      : num [1:155] -0.1552 0.0133 -0.829 -0.1552 -0.829 ...
##  $ sum_prof_other_l_possessor_agr      : num [1:155] -0.583 0.702 -0.583 -0.583 -0.583 ...
##  $ sum_use_other_l_possessum_agr       : num [1:155] 0 0 0 0 0 0 0 0 0 0 ...
##  $ sum_use_other_l_possessor_agr       : num [1:155] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>We can now implement UMAP. It makes sense to play around with the number of neighbors and components to see what solution makes sense.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="umap-and-t-sne.html#cb34-1" tabindex="-1"></a>umap.bres <span class="ot">&lt;-</span> <span class="fu">umap</span>(bfeatures, </span>
<span id="cb34-2"><a href="umap-and-t-sne.html#cb34-2" tabindex="-1"></a>                  <span class="at">n_neighbors =</span> <span class="dv">10</span>, </span>
<span id="cb34-3"><a href="umap-and-t-sne.html#cb34-3" tabindex="-1"></a>                  <span class="at">n_components =</span> <span class="dv">2</span>, </span>
<span id="cb34-4"><a href="umap-and-t-sne.html#cb34-4" tabindex="-1"></a>                  <span class="at">random_state =</span> <span class="dv">15</span></span>
<span id="cb34-5"><a href="umap-and-t-sne.html#cb34-5" tabindex="-1"></a>                  ) </span>
<span id="cb34-6"><a href="umap-and-t-sne.html#cb34-6" tabindex="-1"></a>umap.bres <span class="ot">&lt;-</span> umap.bres[[<span class="st">&quot;layout&quot;</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="umap-and-t-sne.html#cb34-7" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="umap-and-t-sne.html#cb34-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Participant =</span> blabel,</span>
<span id="cb34-9"><a href="umap-and-t-sne.html#cb34-9" tabindex="-1"></a>                <span class="at">LanguageGroup =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(blabel, <span class="st">&quot;_.*&quot;</span>))</span>
<span id="cb34-10"><a href="umap-and-t-sne.html#cb34-10" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb34-11"><a href="umap-and-t-sne.html#cb34-11" tabindex="-1"></a><span class="fu">str</span>(umap.bres)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    155 obs. of  4 variables:
##  $ V1           : num  -0.0346 1.6275 -0.3477 -0.9739 0.703 ...
##  $ V2           : num  3.988 -1.631 4.168 4.396 -0.735 ...
##  $ Participant  : chr  &quot;DutchEnglish_5826131&quot; &quot;DutchEnglish_5833616&quot; &quot;DutchEnglish_5849237&quot; &quot;DutchEnglish_5849238&quot; ...
##  $ LanguageGroup: chr  &quot;DutchEnglish&quot; &quot;DutchEnglish&quot; &quot;DutchEnglish&quot; &quot;DutchEnglish&quot; ...</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="umap-and-t-sne.html#cb36-1" tabindex="-1"></a>umap.bres <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="umap-and-t-sne.html#cb36-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">color =</span> LanguageGroup)) <span class="sc">+</span></span>
<span id="cb36-3"><a href="umap-and-t-sne.html#cb36-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-4"><a href="umap-and-t-sne.html#cb36-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/visumap2-1.png" width="672" /></p>
<p>In this case there is not too much to see but there are more similar groups of participants (but we did not include items or test condition in the analysis).</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-becht2019dimensionality" class="csl-entry">
Becht, Etienne, Leland McInnes, John Healy, Charles-Antoine Dutertre, Immanuel WH Kwok, Lai Guan Ng, Florent Ginhoux, and Evan W Newell. 2019. <span>“Dimensionality Reduction for Visualizing Single-Cell Data Using UMAP.”</span> <em>Nature Biotechnology</em> 37 (1): 38–44.
</div>
<div id="ref-gisbrecht2015parametric" class="csl-entry">
Gisbrecht, Andrej, Alexander Schulz, and Barbara Hammer. 2015. <span>“Parametric Nonlinear Dimensionality Reduction Using Kernel t-SNE.”</span> <em>Neurocomputing</em> 147: 71–82.
</div>
<div id="ref-kobak2021initialization" class="csl-entry">
Kobak, Dmitry, and George C Linderman. 2021. <span>“Initialization Is Critical for Preserving Global Data Structure in Both t-SNE and UMAP.”</span> <em>Nature Biotechnology</em> 39 (2): 156–57.
</div>
<div id="ref-mcinnes2018umap" class="csl-entry">
McInnes, Leland, John Healy, and James Melville. 2018. <span>“Umap: Uniform Manifold Approximation and Projection for Dimension Reduction.”</span> <em>arXiv Preprint arXiv:1802.03426</em>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="generating-interactive-notebooks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mschw81/AcqVA-Aurora-UMAP-WS/edit/main/02-umap.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/mschw81/AcqVA-Aurora-UMAP-WS/blob/main/02-umap.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
